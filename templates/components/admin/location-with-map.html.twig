<div {{ attributes }} data-controller="location-map">
    <div class="space-y-4">
        {# Map Container #}
        <div class="rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700 shadow-sm">
            <div 
                data-location-map-target="map" 
                id="location-map-{{ locationForm.vars.id|default(random()) }}"
                class="w-full location-map-container"
                style="height: 400px !important; min-height: 400px !important; width: 100% !important; position: relative; z-index: 1;"
            >
                <div class="flex items-center justify-center h-full text-muted-foreground">
                    <div class="text-center">
                        <twig:ux:icon name="lucide:map-pin" class="h-12 w-12 mx-auto mb-2 opacity-50"/>
                        <p class="text-sm">Loading map...</p>
                    </div>
                </div>
            </div>
        </div>

        {# Location Form Fields #}
        <div class="grid gap-4 md:grid-cols-2">
            <div class="md:col-span-2 space-y-2">
                {{ form_label(locationForm.address, 'Address') }}
                {{ form_widget(locationForm.address, {
                    'attr': {
                        'data-location-map-target': 'address',
                        'class': 'w-full rounded-md border border-input bg-background px-3 py-2 text-sm',
                        'placeholder': 'Click on map to select location or enter address manually'
                    }
                }) }}
                {{ form_errors(locationForm.address) }}
                <p class="text-xs text-muted-foreground">
                    Click on the map to select a location, or enter an address and press Enter to search
                </p>
            </div>
            <div class="space-y-2">
                {{ form_label(locationForm.latitude, 'Latitude') }}
                {{ form_widget(locationForm.latitude, {
                    'attr': {
                        'data-location-map-target': 'latitude',
                        'class': 'w-full rounded-md border border-input bg-background px-3 py-2 text-sm bg-muted/30',
                        'readonly': true
                    }
                }) }}
                {{ form_errors(locationForm.latitude) }}
                <p class="text-xs text-muted-foreground">Auto-filled from map</p>
            </div>
            <div class="space-y-2">
                {{ form_label(locationForm.longitude, 'Longitude') }}
                {{ form_widget(locationForm.longitude, {
                    'attr': {
                        'data-location-map-target': 'longitude',
                        'class': 'w-full rounded-md border border-input bg-background px-3 py-2 text-sm bg-muted/30',
                        'readonly': true
                    }
                }) }}
                {{ form_errors(locationForm.longitude) }}
                <p class="text-xs text-muted-foreground">Auto-filled from map</p>
            </div>
        </div>

        {# Instructions #}
        <div class="flex items-start gap-2 p-3 bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800 rounded-lg text-sm">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mt-0.5 flex-shrink-0 text-blue-600 dark:text-blue-400">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
            <div class="text-blue-900 dark:text-blue-100">
                <strong>How to use:</strong>
                <ul class="mt-1 ml-4 list-disc space-y-1">
                    <li>Click anywhere on the map to set the delivery location</li>
                    <li>Drag the marker to adjust the position</li>
                    <li>Or enter an address in the field above to search</li>
                    <li>Leave empty for pickup orders</li>
                </ul>
            </div>
        </div>
    </div>
</div>

