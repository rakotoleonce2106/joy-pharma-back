<div {{ attributes }}>
    {{ form_start(form, { attr: {
        class: 'space-y-6',
        'id': 'product-form'
    } }) }}

    {# Basic Information Section #}
    <div class="space-y-4">
        <div class="flex items-center gap-2 pb-2 border-b">
            <twig:ux:icon name="lucide:package" class="h-5 w-5 text-primary"/>
            <h3 class="text-lg font-semibold">Basic Information</h3>
        </div>
        <div class="grid gap-4 md:grid-cols-2">
            <div class="md:col-span-2">
                {{ form_row(form.name, {
                    'help': 'Enter the product name as it will appear to customers'
                }) }}
            </div>
            <div>
                {{ form_row(form.code, {
                    'help': 'Product SKU or barcode'
                }) }}
            </div>
            <div>
                {{ form_row(form.isActive, {
                    'label_attr': {'class': 'flex items-center gap-2'},
                    'help': 'Make product visible to customers'
                }) }}
            </div>
            <div class="md:col-span-2">
                {{ form_row(form.description, {
                    'help': 'Detailed product description, benefits, and usage instructions'
                }) }}
            </div>
        </div>
    </div>

    {# Classification Section #}
    <div class="space-y-4">
        <div class="flex items-center gap-2 pb-2 border-b">
            <twig:ux:icon name="lucide:folder-tree" class="h-5 w-5 text-primary"/>
            <h3 class="text-lg font-semibold">Classification</h3>
        </div>
        <div class="grid gap-4 md:grid-cols-2">
            <div>
                {{ form_row(form.category, {
                    'help': 'Select one or more categories'
                }) }}
            </div>
            <div>
                {{ form_row(form.form, {
                    'help': 'Product form (tablet, liquid, etc.)'
                }) }}
            </div>
            <div>
                {{ form_row(form.manufacturer, {
                    'help': 'Product manufacturer'
                }) }}
            </div>
            <div>
                {{ form_row(form.brand, {
                    'help': 'Product brand name'
                }) }}
            </div>
        </div>
    </div>

    {# Pricing & Stock Section #}
    <div class="space-y-4">
        <div class="flex items-center gap-2 pb-2 border-b">
            <twig:ux:icon name="lucide:dollar-sign" class="h-5 w-5 text-primary"/>
            <h3 class="text-lg font-semibold">Pricing & Stock</h3>
        </div>
        <div class="grid gap-4 md:grid-cols-3">
            <div>
                {{ form_row(form.unitPrice, {
                    'help': 'Price per unit'
                }) }}
            </div>
            <div>
                {{ form_row(form.totalPrice, {
                    'help': 'Total package price'
                }) }}
            </div>
            <div>
                {{ form_row(form.currency, {
                    'help': 'Currency'
                }) }}
            </div>
            <div>
                {{ form_row(form.quantity, {
                    'help': 'Units per package'
                }) }}
            </div>
            <div>
                {{ form_row(form.unit, {
                    'help': 'Unit of measurement'
                }) }}
            </div>
        </div>
    </div>

    {# Images Section #}
    <div class="space-y-4">
        <div class="flex items-center gap-2 pb-2 border-b">
            <twig:ux:icon name="lucide:images" class="h-5 w-5 text-primary"/>
            <h3 class="text-lg font-semibold">Product Images</h3>
        </div>
        
        {# Existing Images Preview - Horizontal Scroll #}
        {% if initialFormData and initialFormData.images is defined and initialFormData.images|length > 0 %}
            <div class="space-y-2">
                <label class="text-sm font-medium text-muted-foreground">Current Images</label>
                <div class="flex gap-3 overflow-x-auto pb-2">
                    {% for image in initialFormData.images %}
                        {% if image.url %}
                            <div class="flex-shrink-0 w-24">
                                <div class="border rounded-lg overflow-hidden" style="height: 100px; width: 100px;">
                                    <img src="{{ image.url }}" alt="{{ image.name ?? '' }}" class="w-full h-full object-cover">
                                </div>
                                <p class="text-xs text-muted-foreground mt-1 truncate text-center">{{ image.name ?? '' }}</p>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        {% endif %}

        {# Upload New Images #}
        <div class="border-2 border-dashed rounded-lg p-8 text-center hover:border-primary transition-colors cursor-pointer relative"
             onclick="document.getElementById('{{ form.images.vars.id }}').click()">
            <twig:ux:icon name="lucide:upload-cloud" class="h-8 w-8 mx-auto mb-2 text-muted-foreground"/>
            <p class="text-base font-medium text-foreground mb-2">Click to upload images</p>
            <p class="text-sm text-muted-foreground mb-1">or drag and drop</p>
            <p class="text-xs text-muted-foreground mt-4">JPG, PNG or WebP (max. 5MB per file)</p>
            <div class="hidden">
                {{ form_widget(form.images) }}
            </div>
        </div>
        {% if form.images.vars.errors|length > 0 %}
            <div class="text-sm text-destructive mt-2">
                {{ form_errors(form.images) }}
            </div>
        {% endif %}
    </div>

    {# Hidden Turbo Frame Buttons #}
    <div class="items-center justify-center gap-2 mt-6 hidden turbo-frame:flex">
        <twig:ui:button:root href="{{ path('admin_product') }}" variant="outline">
            {{ 'Discard'|trans }}
        </twig:ui:button:root>
        <twig:ui:button:root formnovalidate>{{ 'Save Product'|trans }}</twig:ui:button:root>
    </div>

    {{ form_end(form) }}
</div>
