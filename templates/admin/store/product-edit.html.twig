{% extends 'admin/layout.html.twig' %}

{% block title %}{{ 'Edit Store Product'|trans }}{% endblock %}

{% block content %}
    <main class="flex flex-1 flex-col gap-4 p-4 md:gap-8 md:p-8">
        <div class="mx-auto grid w-full max-w-5xl gap-6">
            <div class="flex items-center gap-4">
                <twig:ui:button:root href="{{ path('admin_store_edit', {id: store.id}) }}" variant="outline" size="icon" class="h-8 w-8">
                    <twig:ux:icon name="radix-icons:chevron-left" class="h-4 w-4"/>
                    <span class="sr-only">{{ 'Back'|trans }}</span>
                </twig:ui:button:root>
                <div class="flex-1">
                    <h1 class="text-3xl font-bold tracking-tight">
                        {{ 'Edit Product'|trans }}
                    </h1>
                    <p class="text-muted-foreground">
                        Update <strong>{{ storeProduct.product.name }}</strong> for <strong>{{ store.name }}</strong>
                    </p>
                </div>
                <div class="hidden items-center gap-2 md:flex">
                    <twig:ui:button:root variant="outline" size="sm" href="{{ path('admin_store_edit', {id: store.id}) }}">
                        {{ 'Cancel'|trans }}
                    </twig:ui:button:root>
                    <twig:ui:button:root type="submit" form="store-product-form" size="sm" data-turbo-submits-with="Updating...">
                        {{ 'Update Product'|trans }}
                    </twig:ui:button:root>
                </div>
            </div>

            <twig:ui:card:root>
                <twig:ui:card:header>
                    <twig:ui:card:title>{{ 'Product Details'|trans }}</twig:ui:card:title>
                    <twig:ui:card:description>
                        {{ 'Update the pricing and stock information for this product'|trans }}
                    </twig:ui:card:description>
                </twig:ui:card:header>
                <twig:ui:card:content>
                    {{ form_start(form, {
                        'attr': {
                            'id': 'store-product-form',
                            'class': 'space-y-6'
                        }
                    }) }}

                    <div class="space-y-4">
                        {# Product Info Display #}
                        <div class="flex items-start gap-4 p-4 bg-muted/50 rounded-lg border">
                            {% if storeProduct.product.images|length > 0 %}
                                <div class="flex-shrink-0 rounded-lg overflow-hidden border-2 border-border shadow-sm" style="max-height: 80px; width: auto;">
                                    <img src="{{ storeProduct.product.images|first.url ?? '' }}" 
                                         alt="{{ storeProduct.product.name }}"
                                         class="object-cover"
                                         style="max-height: 80px; width: auto;">
                                </div>
                            {% else %}
                                <div class="flex-shrink-0 w-20 rounded-lg bg-muted border-2 border-dashed border-border flex items-center justify-center" style="height: 80px;">
                                    <twig:ux:icon name="lucide:package" class="h-10 w-10 text-muted-foreground"/>
                                </div>
                            {% endif %}
                            <div class="flex-1 min-w-0">
                                <div class="font-semibold text-lg mb-1">{{ storeProduct.product.name }}</div>
                                <div class="text-sm text-muted-foreground flex items-center gap-1">
                                    {% if storeProduct.product.brand %}
                                        <twig:ux:icon name="lucide:tag" class="h-3 w-3"/>
                                        {{ storeProduct.product.brand.name }}
                                    {% else %}
                                        No brand
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        {# Hidden product field - product cannot be changed when editing #}
                        <div class="hidden">
                            {{ form_widget(form.product) }}
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="flex items-center gap-2 pb-2 border-b">
                            <twig:ux:icon name="lucide:dollar-sign" class="h-5 w-5 text-primary"/>
                            <h3 class="text-lg font-semibold">Pricing Information</h3>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                {{ form_row(form.unitPrice) }}
                            </div>
                            <div>
                                {{ form_row(form.price) }}
                            </div>
                        </div>

                        <div class="flex items-start gap-2 p-3 bg-amber-50 dark:bg-amber-950/20 border border-amber-200 dark:border-amber-800 rounded-lg">
                            <twig:ux:icon name="lucide:lightbulb" class="h-5 w-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5"/>
                            <div class="text-sm text-amber-900 dark:text-amber-100">
                                <p class="font-medium mb-1">Pricing Tips</p>
                                <ul class="text-amber-700 dark:text-amber-300 list-disc list-inside space-y-1">
                                    <li><strong>Unit Price:</strong> Optional - price per individual item (e.g., per pill)</li>
                                    <li><strong>Total Price:</strong> Required - the final selling price for the package</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="flex items-center gap-2 pb-2 border-b">
                            <twig:ux:icon name="lucide:package" class="h-5 w-5 text-primary"/>
                            <h3 class="text-lg font-semibold">Stock Information</h3>
                        </div>
                        
                        {{ form_row(form.stock) }}

                        <div class="flex items-start gap-2 p-3 bg-green-50 dark:bg-green-950/20 border border-green-200 dark:border-green-800 rounded-lg">
                            <twig:ux:icon name="lucide:check-circle" class="h-5 w-5 text-green-600 dark:text-green-400 flex-shrink-0 mt-0.5"/>
                            <div class="text-sm text-green-900 dark:text-green-100">
                                <p class="font-medium mb-1">Stock Indicators</p>
                                <ul class="text-green-700 dark:text-green-300 list-disc list-inside space-y-1">
                                    <li><strong>High Stock:</strong> More than 10 units (green badge)</li>
                                    <li><strong>Low Stock:</strong> 1-10 units (amber badge)</li>
                                    <li><strong>Out of Stock:</strong> 0 units (red badge)</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    {{ form_end(form) }}
                </twig:ui:card:content>
            </twig:ui:card:root>

            <div class="flex items-center justify-end gap-2 md:hidden">
                <twig:ui:button:root variant="outline" size="sm" href="{{ path('admin_store_edit', {id: store.id}) }}">
                    {{ 'Cancel'|trans }}
                </twig:ui:button:root>
                <twig:ui:button:root type="submit" form="store-product-form" size="sm" data-turbo-submits-with="Updating...">
                    {{ 'Update Product'|trans }}
                </twig:ui:button:root>
            </div>
        </div>
    </main>
{% endblock %}

