{% extends 'admin/layout.html.twig' %}

{% block title %}{{ 'Edit Store'|trans }}{% endblock %}

{% block content %}
    <main class="flex flex-1 flex-col gap-4 p-4 md:gap-8 md:p-8 w-[85rem]">
        <div class="mx-auto grid w-full max-w-6xl gap-6">
                <div class="flex items-center gap-4">
                <twig:ui:button:root href="{{ path('admin_store') }}" variant="outline" size="icon" class="h-8 w-8">
                        <twig:ux:icon name="radix-icons:chevron-left" class="h-4 w-4"/>
                        <span class="sr-only">{{ 'Back'|trans }}</span>
                    </twig:ui:button:root>
                <h1 class="flex-1 text-3xl font-bold tracking-tight">
                    {{ store.name }}
                    </h1>
                <div class="hidden items-center gap-2 md:flex">
                        <twig:ui:button:root variant="outline" size="sm" href="{{ path('admin_store') }}">
                        {{ 'Cancel'|trans }}
                        </twig:ui:button:root>
                    <twig:ui:button:root type="submit" form="store-form" size="sm" data-turbo-submits-with="Updating..." id="save-store-btn">
                        {{ 'Update Store'|trans }}
                        </twig:ui:button:root>
                    </div>
            </div>

            {# Tab Navigation #}
            <div class="border-b border-border">
                <nav class="flex gap-6" aria-label="Store tabs">
                    <button type="button" 
                            class="tab-button px-4 py-3 text-sm font-medium border-b-2 transition-colors active" 
                            data-tab="info"
                            onclick="switchTab('info')">
                        <div class="flex items-center gap-2">
                            <twig:ux:icon name="lucide:store" class="h-4 w-4"/>
                            Store Info
                        </div>
                    </button>
                    <button type="button" 
                            class="tab-button px-4 py-3 text-sm font-medium border-b-2 transition-colors" 
                            data-tab="login"
                            onclick="switchTab('login')">
                        <div class="flex items-center gap-2">
                            <twig:ux:icon name="lucide:key" class="h-4 w-4"/>
                            Store Login
                        </div>
                    </button>
                    <button type="button" 
                            class="tab-button px-4 py-3 text-sm font-medium border-b-2 transition-colors" 
                            data-tab="products"
                            onclick="switchTab('products')">
                        <div class="flex items-center gap-2">
                            <twig:ux:icon name="lucide:package" class="h-4 w-4"/>
                            Store Products
                            <span class="ml-1 px-2 py-0.5 text-xs rounded-full bg-primary/10 text-primary">
                                {{ store.storeProducts|length }}
                            </span>
                        </div>
                    </button>
                </nav>
            </div>

            {# Form Start - wraps all tabs #}
            {{ form_start(form, { attr: {
                'id': 'store-form',
                'class': 'tab-content-container'
            } }) }}

            {# Tab Content #}
            <div>
                {# Store Info Tab #}
                <div id="tab-info" class="tab-content active">
                    <twig:ui:card:root>
                        <twig:ui:card:header>
                            <twig:ui:card:title>{{ 'Store Information'|trans }}</twig:ui:card:title>
                            <twig:ui:card:description>
                                {{ 'Update the store information below.'|trans }}
                            </twig:ui:card:description>
                        </twig:ui:card:header>
                        <twig:ui:card:content>
                            {% include 'components/admin/store-info-form.html.twig' with {
                                'initialFormData': store,
                                'form': form
                            } %}
                        </twig:ui:card:content>
                    </twig:ui:card:root>
                </div>

                {# Store Login Tab #}
                <div id="tab-login" class="tab-content hidden">
                            <twig:ui:card:root>
                        <twig:ui:card:header>
                            <twig:ui:card:title>{{ 'Store Owner Login Credentials'|trans }}</twig:ui:card:title>
                            <twig:ui:card:description>
                                {{ 'Manage login credentials for the store owner'|trans }}
                            </twig:ui:card:description>
                        </twig:ui:card:header>
                        <twig:ui:card:content>
                            {% include 'components/admin/store-login-form.html.twig' with {
                                'store': store,
                                'form': form
                            } %}
                        </twig:ui:card:content>
                            </twig:ui:card:root>
                </div>

                {# Store Products Tab #}
                <div id="tab-products" class="tab-content hidden">
                    <twig:ui:card:root>
                        <twig:ui:card:header>
                            <div class="flex items-center justify-between">
                                <div>
                                    <twig:ui:card:title>{{ 'Store Products'|trans }}</twig:ui:card:title>
                                    <twig:ui:card:description>
                                        {{ 'Manage products available in this store with search, filters and pagination'|trans }}
                                    </twig:ui:card:description>
                                </div>
                                <twig:ui:button:root href="{{ path('admin_store_product_add', {id: store.id}) }}" size="sm" data-turbo-frame="_top">
                                    <twig:ux:icon name="lucide:plus" class="h-4 w-4 mr-2"/>
                                    Add Product
                                </twig:ui:button:root>
                            </div>
                        </twig:ui:card:header>
                        <twig:ui:card:content>
                            {% if productsDataTable is defined %}
                                {{ data_table(productsDataTable) }}
                            {% else %}
                                <div class="flex flex-col items-center justify-center py-12 text-center">
                                    <div class="rounded-full bg-muted p-4 mb-4">
                                        <twig:ux:icon name="lucide:package" class="h-12 w-12 text-muted-foreground"/>
                                    </div>
                                    <h3 class="text-lg font-semibold mb-2">{{ 'No Products Yet'|trans }}</h3>
                                    <p class="text-sm text-muted-foreground mb-4">
                                        {{ 'This store doesn\'t have any products listed yet.'|trans }}
                                    </p>
                                    <twig:ui:button:root href="{{ path('admin_store_product_add', {id: store.id}) }}">
                                        <twig:ux:icon name="lucide:plus" class="h-4 w-4 mr-2"/>
                                        Add First Product
                    </twig:ui:button:root>
                                </div>
                            {% endif %}
                        </twig:ui:card:content>
                    </twig:ui:card:root>
                </div>
            </div>

            {{ form_end(form) }}

            <div class="flex items-center justify-end gap-2 md:hidden">
                <twig:ui:button:root variant="outline" size="sm" href="{{ path('admin_store') }}">
                    {{ 'Cancel'|trans }}
                </twig:ui:button:root>
                <twig:ui:button:root type="submit" form="store-form" size="sm" data-turbo-submits-with="Updating...">
                    {{ 'Update Store'|trans }}
                </twig:ui:button:root>
            </div>
        </div>
    </main>

    <script>
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                if (button.dataset.tab === tabName) {
                    button.classList.add('active', 'border-primary', 'text-primary');
                    button.classList.remove('border-transparent', 'text-muted-foreground', 'hover:text-foreground');
                } else {
                    button.classList.remove('active', 'border-primary', 'text-primary');
                    button.classList.add('border-transparent', 'text-muted-foreground', 'hover:text-foreground');
                }
            });

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                if (content.id === `tab-${tabName}`) {
                    content.classList.remove('hidden');
                    content.classList.add('active');
                } else {
                    content.classList.add('hidden');
                    content.classList.remove('active');
                }
            });

            // Show/hide save button based on tab
            const saveBtn = document.getElementById('save-store-btn');
            if (tabName === 'products') {
                saveBtn.classList.add('hidden');
            } else {
                saveBtn.classList.remove('hidden');
            }
        }

        // Initialize tabs on page load
        document.addEventListener('DOMContentLoaded', function() {
            switchTab('info');
        });
    </script>

    <style>
        .tab-button {
            position: relative;
        }
        
        .tab-button:not(.active) {
            @apply border-transparent text-muted-foreground hover:text-foreground hover:border-border;
        }
        
        .tab-button.active {
            @apply border-primary text-primary;
        }
    </style>
{% endblock %}

{% block stream_success %}
    <turbo-stream action="refresh"></turbo-stream>
{% endblock %}
