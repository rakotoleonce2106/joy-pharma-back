# Password Management APIs

# Send Reset Email
App\Dto\ResetPasswordInput:
    operations:
        send_reset_email:
            class: ApiPlatform\Metadata\Post
            uriTemplate: '/password/forgot'
            processor: App\State\Password\SendResetEmailProcessor
            read: false
            openapi:
                summary: 'Send password reset email'
                description: 'Send a 6-digit reset code to the user email address'
                requestBody:
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    email:
                                        type: string
                                        format: email
                                required:
                                    - email
                responses:
                    '200':
                        description: 'Reset code sent'
                        content:
                            application/json:
                                schema:
                                    type: object
                                    properties:
                                        success:
                                            type: boolean
                                        message:
                                            type: string

        verify_reset_code:
            class: ApiPlatform\Metadata\Post
            uriTemplate: '/password/verify-code'
            processor: App\State\Password\VerifyResetCodeProcessor
            read: false
            openapi:
                summary: 'Verify password reset code'
                description: 'Verify that the reset code is valid and not expired'
                requestBody:
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    email:
                                        type: string
                                        format: email
                                    code:
                                        type: string
                                        minLength: 4
                                        maxLength: 6
                                required:
                                    - email
                                    - code
                responses:
                    '200':
                        description: 'Code is valid'
                        content:
                            application/json:
                                schema:
                                    type: object
                                    properties:
                                        valid:
                                            type: boolean
                                        message:
                                            type: string
                    '400':
                        description: 'Invalid or expired code'

        reset_password:
            class: ApiPlatform\Metadata\Post
            uriTemplate: '/password/reset'
            processor: App\State\Password\ResetPasswordProcessor
            read: false
            openapi:
                summary: 'Reset password'
                description: 'Reset user password with validated code'
                requestBody:
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    email:
                                        type: string
                                        format: email
                                    code:
                                        type: string
                                        minLength: 4
                                        maxLength: 6
                                    password:
                                        type: string
                                        minLength: 8
                                required:
                                    - email
                                    - code
                                    - password
                responses:
                    '200':
                        description: 'Password reset successfully'
                        content:
                            application/json:
                                schema:
                                    type: object
                                    properties:
                                        success:
                                            type: boolean
                                        message:
                                            type: string
                    '400':
                        description: 'Invalid or expired code'

# Update Password (Authenticated)
App\Dto\UpdatePasswordInput:
    operations:
        update_password:
            class: ApiPlatform\Metadata\Post
            uriTemplate: '/user/update-password'
            processor: App\State\Password\UpdatePasswordProcessor
            read: false
            security: 'is_granted("ROLE_USER")'
            openapi:
                summary: 'Update user password'
                description: 'Update the password for the currently authenticated user'
                security:
                    - JWT: []
                requestBody:
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    currentPassword:
                                        type: string
                                    newPassword:
                                        type: string
                                        minLength: 8
                                    confirmPassword:
                                        type: string
                                required:
                                    - currentPassword
                                    - newPassword
                                    - confirmPassword
                responses:
                    '200':
                        description: 'Password updated successfully'
                        content:
                            application/json:
                                schema:
                                    type: object
                                    properties:
                                        success:
                                            type: boolean
                                        message:
                                            type: string
                    '400':
                        description: 'Current password is incorrect'
                    '401':
                        description: 'User not authenticated'

