App\Entity\User:
    operations:
        get_collection:
            class: ApiPlatform\Metadata\GetCollection
            openapi:
                security:
                    -   JWT: [ 'ROLE_ADMIN' ]

        put:
            class: ApiPlatform\Metadata\Put
            uriTemplate: "/user/update"
            validationContext:
                groups: ['user:update' ]
            normalizationContext:
                groups: ['id:read', "user:read", "image:read", "media_object:read", "location:read" ]
            security: "is_granted('ROLE_USER')"
            input_formats:
                multipart: [ 'multipart/form-data' ]
            processor: App\State\User\UserUpdateProcessor
            openapi:
                summary: "Update user profile"
                description: "Update user profile information with optional avatar upload"

        facebook_login:
            method: "POST"
            class: ApiPlatform\Metadata\Post
            controller: 'App\Controller\Api\FacebookAuthController'
            input: 'App\Dto\SocialInput'
            public: true
            uriTemplate: "/facebook_login"
            openapi:
                summary: "Facebook login"
                description: "Login with Facebook and receive JWT token"

        google_login:
            method: "POST"
            class: ApiPlatform\Metadata\Post
            controller: 'App\Controller\Api\GoogleAuthController'
            public: true
            input: 'App\Dto\SocialInput'
            uriTemplate: "/google_login"
            openapi:
                summary: "Google login"
                description: "Login with Google and receive JWT token"
            

        delete:
            class: ApiPlatform\Metadata\Delete
            openapi:
                security:
                    -   JWT: [ 'ROLE_ADMIN' ]

        current_user:
            class: ApiPlatform\Metadata\Get
            security: 'is_granted("ROLE_USER")'
            securityMessage: 'Only authenticated users can get current user.'
            method: GET
            uriTemplate: "/me"
            provider: App\State\User\CurrentUserProvider
            normalizationContext:
                groups: ['id:read', "user:read" ,"image:read","media_object:read","store:read","location:read"]
            uriVariables: []
            openapiContext:
                summary: Retrieves the current user resource.
                description: >
                    Retrieves the current user resource.
            openapi:
                summary: "Get  current user."
                description: "Get  current user."

        remove_location:
            class: ApiPlatform\Metadata\Delete
            security: 'is_granted("ROLE_USER")'
            securityMessage: 'Only authenticated users can remove locations.'
            method: DELETE
            uriTemplate: "/me/locations/{locationId}"
            controller: App\Controller\Api\UserLocationController
            openapi:
                summary: "Remove a location from current user's saved locations"
                description: "Remove a location from the authenticated user's saved locations"
                parameters:
                    - name: locationId
                      in: path
                      required: true
                      schema:
                        type: integer
                      description: The ID of the location to remove

        # Admin specific endpoints
        admin_get_users:
            class: ApiPlatform\Metadata\GetCollection
            uriTemplate: '/admin/users'
            security: 'is_granted("ROLE_ADMIN")'
            provider: App\State\Admin\UserProvider
            normalizationContext:
                groups: ['id:read', 'user:read', 'image:read', 'media_object:read']
            openapi:
                summary: 'List all users (Admin)'
                description: 'Get list of users with optional type filter (all, delivers, stores, customers) or role filter'
                parameters:
                    - name: type
                      in: query
                      schema:
                          type: string
                          enum: [all, delivers, stores, customers]
                          default: all
                      description: 'Filter users by type'
                    - name: role
                      in: query
                      schema:
                          type: string
                      description: 'Filter users by specific role (e.g., ROLE_ADMIN, ROLE_STORE, ROLE_DELIVER, ROLE_USER). Takes precedence over type filter if both are provided.'

        admin_get_user:
            class: ApiPlatform\Metadata\Get
            uriTemplate: '/admin/users/{id}'
            security: 'is_granted("ROLE_ADMIN")'
            normalizationContext:
                groups: ['id:read', 'user:read', 'image:read', 'media_object:read']
            openapi:
                summary: 'Get user by ID (Admin)'
                description: 'Get detailed information about a specific user'

        admin_create_user:
            class: ApiPlatform\Metadata\Post
            uriTemplate: '/admin/users'
            security: 'is_granted("ROLE_ADMIN")'
            input: App\Dto\Admin\UserInput
            processor: App\State\Admin\UserProcessor
            normalizationContext:
                groups: ['id:read', 'user:read', 'image:read', 'media_object:read']
            openapi:
                summary: 'Create new user (Admin)'
                description: 'Create a new user account with specified roles and permissions'

        admin_update_user:
            class: ApiPlatform\Metadata\Put
            uriTemplate: '/admin/users/{id}'
            security: 'is_granted("ROLE_ADMIN")'
            input: App\Dto\Admin\UserInput
            processor: App\State\Admin\UserProcessor
            normalizationContext:
                groups: ['id:read', 'user:read', 'image:read', 'media_object:read']
            openapi:
                summary: 'Update user (Admin)'
                description: 'Update user information including roles and active status'

        admin_delete_user:
            class: ApiPlatform\Metadata\Delete
            uriTemplate: '/admin/users/{id}'
            security: 'is_granted("ROLE_ADMIN")'
            openapi:
                summary: 'Delete user (Admin)'
                description: 'Permanently delete a user account'

        admin_toggle_user_active:
            class: ApiPlatform\Metadata\Post
            uriTemplate: '/admin/users/{id}/toggle-active'
            security: 'is_granted("ROLE_ADMIN")'
            processor: App\State\Admin\ToggleUserActiveProcessor
            normalizationContext:
                groups: ['id:read', 'user:read']
            openapi:
                summary: 'Toggle user active status (Admin)'
                description: 'Activate or deactivate a user account'


    normalizationContext:
        groups: ['id:read','user:read','image:read','media_object:read','location:read']

    denormalizationContext:
        groups: ['user:create', 'user:update']
        


