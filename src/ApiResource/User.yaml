App\Entity\User:
    operations:
        get_collection:
            class: ApiPlatform\Metadata\GetCollection
            openapi:
                security:
                    -   JWT: [ 'ROLE_ADMIN' ]

        patch:
            class: ApiPlatform\Metadata\Post
            uriTemplate: "/user/update"
            validationContext:
                groups: ['user:update' ]
            normalizationContext:
                groups: ['id:read', "user:read" ]
            security: "is_granted('ROLE_USER')"
            input_formats:
                multipart: [ 'multipart/form-data' ]
            processor: App\State\User\UserUpdateProcessor
            openapi:
                summary: "Update user profile"
                description: "Update user profile information with optional avatar upload"

        facebook_login:
            method: "POST"
            class: ApiPlatform\Metadata\Post
            controller: 'App\Controller\Api\FacebookAuthController'
            input: 'App\Dto\SocialInput'
            public: true
            uriTemplate: "/facebook_login"
            openapi:
                summary: "Facebook login"
                description: "Login with Facebook and receive JWT token"

        google_login:
            method: "POST"
            class: ApiPlatform\Metadata\Post
            controller: 'App\Controller\Api\GoogleAuthController'
            public: true
            input: 'App\Dto\SocialInput'
            uriTemplate: "/google_login"
            openapi:
                summary: "Google login"
                description: "Login with Google and receive JWT token"
            

        delete:
            class: ApiPlatform\Metadata\Delete
            openapi:
                security:
                    -   JWT: [ 'ROLE_ADMIN' ]

        current_user:
            class: ApiPlatform\Metadata\Get
            security: 'is_granted("ROLE_USER")'
            securityMessage: 'Only authenticated users can get current user.'
            method: GET
            uriTemplate: "/me"
            provider: App\State\User\CurrentUserProvider
            normalizationContext:
                groups: ['id:read', "user:read" ,"image:read","store:read"]
            uriVariables: []
            openapiContext:
                summary: Retrieves the current user resource.
                description: >
                    Retrieves the current user resource.
            openapi:
                summary: "Get  current user."
                description: "Get  current user."

        # List all delivery users (admin only)
        list_delivers:
            class: ApiPlatform\Metadata\GetCollection
            uriTemplate: '/admin/delivers'
            security: 'is_granted("ROLE_ADMIN")'
            provider: App\State\User\DeliversListProvider
            paginationEnabled: false
            normalizationContext:
                groups: ['id:read','user:read']
            openapi:
                summary: 'List all delivery users'
                description: 'List all users with ROLE_DELIVER'

        # Activate/deactivate a delivery user (admin only)
        activate_deliver:
            class: ApiPlatform\Metadata\Put
            uriTemplate: '/admin/delivers/{id}/activation'
            security: 'is_granted("ROLE_ADMIN")'
            processor: App\State\User\ActivateDeliverProcessor
            input: false
            openapi:
                summary: 'Activate or deactivate a delivery user'
                description: 'Toggle deliver active status with { "isActive": true|false }'

    normalizationContext:
        groups: ['id:read','user:read']

    denormalizationContext:
        groups: ['user:create', 'user:update']
        


