App\Entity\User:
    operations:
        get_collection:
            class: ApiPlatform\Metadata\GetCollection
            openapi:
                security:
                    -   JWT: [ 'ROLE_ADMIN' ]

        post:
            class: ApiPlatform\Metadata\Post
            processor: App\State\UserPasswordHasher
            uriTemplate: "/register"
            validationContext:
                groups: ['Default', 'user:create']
            normalizationContext:
                groups: [ 'id:read',"user:read" ]
            input_formats:
                multipart: [ 'multipart/form-data' ]

        patch:
            class: ApiPlatform\Metadata\Post
            uriTemplate: "/user/update"
            validationContext:
                groups: ['user:update' ]
            normalizationContext:
                groups: ['id:read', "user:read" ]
            security: "is_granted('ROLE_USER')"
            input_formats:
                multipart: [ 'multipart/form-data' ]
            processor: App\State\UserUpdateProcessor
            
        update_password:
            method: "POST"
            class: ApiPlatform\Metadata\Post
            controller: 'App\Controller\Api\UpdatePasswordController'
            input: 'App\Dto\UpdatePasswordInput'
            uriTemplate: "/user/update-password"
            normalizationContext:
                groups: ['update_password:write']
            security: "is_granted('ROLE_USER')"
            openapi:
                summary: "Update user password"
                description: "Update the password for the currently authenticated user"
                security:
                    - JWT: []
                requestBody:
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    currentPassword:
                                        type: string
                                    newPassword:
                                        type: string
                                        minLength: 8
                                    confirmPassword:
                                        type: string
                                required:
                                    - currentPassword
                                    - newPassword
                                    - confirmPassword

        facebook_login:
            method: "POST"
            class: ApiPlatform\Metadata\Post
            controller: 'App\Controller\Api\FacebookAuthController'
            input: 'App\Dto\SocialInput'
            public: true
            uriTemplate: "/facebook_login"
            openapi:
                summary: "Facebook login"
                description: "Facebook login."

        google_login:
            method: "POST"
            class: ApiPlatform\Metadata\Post
            controller: 'App\Controller\Api\GoogleAuthController'
            public: true
            input: 'App\Dto\SocialInput'
            uriTemplate: "/google_login"
            openapi:
                summary: "Google login"
                description: "Google login."
            

        delete:
            class: ApiPlatform\Metadata\Delete
            openapi:
                security:
                    -   JWT: [ 'ROLE_ADMIN' ]
            
        current_user:
            class: ApiPlatform\Metadata\Get
            security: 'is_granted("ROLE_USER")'
            securityMessage: 'Only authenticated users can get current user.'
            method: GET
            uriTemplate: "/me"
            provider: App\State\CurrentUserProvider
            normalizationContext:
                groups: ['id:read', "user:read" ,"image:read"]
            uriVariables: []
            openapiContext:
                summary: Retrieves the current user resource.
                description: >
                    Retrieves the current user resource.
            openapi:
                summary: "Get  current user."
                description: "Get  current user."

    normalizationContext:
        groups: ['id:read','user:read']

    denormalizationContext:
        groups: ['user:create', 'user:update']
        


