App\Entity\User:
    operations:
        register_customer:
            class: ApiPlatform\Metadata\Post
            uriTemplate: '/register'
            public: true
            denormalizationContext:
                groups: ['user:create']
            validationContext:
                groups: ['create']
            read: false
            openapi:
                summary: 'Register as customer'
                description: 'Register a new customer account and receive JWT token. Use Content-Type: application/ld+json when sending IRIs (e.g., for image). Upload avatar first using POST /api/media_objects with mapping=user_images, then reference it using IRI.'
                requestBody:
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    email:
                                        type: string
                                        format: email
                                    plainPassword:
                                        type: string
                                        minLength: 8
                                    firstName:
                                        type: string
                                    lastName:
                                        type: string
                                    phone:
                                        type: string
                                    image:
                                        type: string
                                        description: IRI of avatar (e.g., "/api/media_objects/123")
                                required:
                                    - email
                                    - plainPassword
                                    - firstName
                                    - lastName
                                    - phone
                        application/ld+json:
                            schema:
                                type: object
                                properties:
                                    email:
                                        type: string
                                        format: email
                                    plainPassword:
                                        type: string
                                        minLength: 8
                                    firstName:
                                        type: string
                                    lastName:
                                        type: string
                                    phone:
                                        type: string
                                    image:
                                        type: string
                                        description: IRI of avatar (e.g., "/api/media_objects/123")
                                required:
                                    - email
                                    - plainPassword
                                    - firstName
                                    - lastName
                                    - phone
                responses:
                    '201':
                        description: 'Customer registered successfully'
                        content:
                            application/json:
                                schema:
                                    type: object
                                    properties:
                                        token:
                                            type: string
                                        refresh_token:
                                            type: string
                                        user:
                                            type: object
                    '409':
                        description: 'Email already exists'
                    '422':
                        description: 'Validation error'

        register_delivery:
            class: ApiPlatform\Metadata\Post
            uriTemplate: '/register/delivery'
            input: 'App\Dto\RegisterDeliveryInput'
            processor: App\State\Auth\RegisterDeliveryProcessor
            read: false
            input_formats:
                multipart: [ 'multipart/form-data' ]
            openapi:
                summary: 'Register as delivery person'
                description: 'Register a new delivery person account and receive JWT token'
                requestBody:
                    content:
                        multipart/form-data:
                            schema:
                                type: object
                                properties:
                                    email:
                                        type: string
                                        format: email
                                    password:
                                        type: string
                                        minLength: 8
                                    firstName:
                                        type: string
                                    lastName:
                                        type: string
                                    phone:
                                        type: string
                                    vehicleType:
                                        type: string
                                        enum: [bike, motorcycle, car, van]
                                    vehiclePlate:
                                        type: string
                                    residenceDocument:
                                        type: string
                                        format: binary
                                    vehicleDocument:
                                        type: string
                                        format: binary
                                required:
                                    - email
                                    - password
                                    - firstName
                                    - lastName
                                    - phone
                                    - vehicleType
                responses:
                    '201':
                        description: 'Delivery person registered successfully'
                        content:
                            application/json:
                                schema:
                                    type: object
                                    properties:
                                        token:
                                            type: string
                                        refresh_token:
                                            type: string
                                        user:
                                            type: object
                                            properties:
                                                userType:
                                                    type: string
                                                    example: delivery
                                                delivery:
                                                    type: object
                    '409':
                        description: 'Email already exists'

        get_collection:
            class: ApiPlatform\Metadata\GetCollection
            openapi:
                security:
                    -   JWT: [ 'ROLE_ADMIN' ]

        put:
            class: ApiPlatform\Metadata\Put
            uriTemplate: "/user/update"
            inputFormats:
                jsonld: ['application/ld+json']
                json: ['application/json']
            denormalizationContext:
                groups: ['user:update']
            validationContext:
                groups: ['user:update']
            normalizationContext:
                groups: ['id:read', "user:read", "image:read", "media_object:read", "location:read" ]
            security: "is_granted('ROLE_USER')"
            openapi:
                summary: "Update user profile - Full update"
                description: "Update user profile information. Upload avatar first using POST /api/media_objects with mapping=user_images, then reference it using IRI (e.g., \"/api/media_objects/123\"). Use Content-Type: application/ld+json when sending IRIs. For partial updates, use PATCH instead."

        patch:
            class: ApiPlatform\Metadata\Patch
            uriTemplate: "/user/update"
            inputFormats:
                jsonld: ['application/ld+json']
                json: ['application/json']
            denormalizationContext:
                groups: ['user:update']
            normalizationContext:
                groups: ['id:read', "user:read", "image:read", "media_object:read", "location:read" ]
            security: "is_granted('ROLE_USER')"
            openapi:
                summary: "Update user profile - Partial update"
                description: "Partially update user profile information. Only provide the fields you want to update. Use Content-Type: application/ld+json when sending IRIs."

        facebook_login:
            method: "POST"
            class: ApiPlatform\Metadata\Post
            controller: 'App\Controller\Api\FacebookAuthController'
            input: 'App\Dto\SocialInput'
            public: true
            uriTemplate: "/facebook_login"
            openapi:
                summary: "Facebook login"
                description: "Login with Facebook and receive JWT token"

        google_login:
            method: "POST"
            class: ApiPlatform\Metadata\Post
            controller: 'App\Controller\Api\GoogleAuthController'
            public: true
            input: 'App\Dto\SocialInput'
            uriTemplate: "/google_login"
            openapi:
                summary: "Google login"
                description: "Login with Google and receive JWT token"
            

        delete:
            class: ApiPlatform\Metadata\Delete
            openapi:
                security:
                    -   JWT: [ 'ROLE_ADMIN' ]

        current_user:
            class: ApiPlatform\Metadata\Get
            security: 'is_granted("ROLE_USER")'
            securityMessage: 'Only authenticated users can get current user.'
            method: GET
            uriTemplate: "/me"
            provider: App\State\User\CurrentUserProvider
            normalizationContext:
                groups: ['id:read', "user:read" ,"image:read","media_object:read","store:read","location:read"]
            uriVariables: []
            openapiContext:
                summary: Retrieves the current user resource.
                description: >
                    Retrieves the current user resource.
            openapi:
                summary: "Get  current user."
                description: "Get  current user."

        remove_location:
            class: ApiPlatform\Metadata\Delete
            security: 'is_granted("ROLE_USER")'
            securityMessage: 'Only authenticated users can remove locations.'
            method: DELETE
            uriTemplate: "/me/locations/{locationId}"
            controller: App\Controller\Api\UserLocationController
            openapi:
                summary: "Remove a location from current user's saved locations"
                description: "Remove a location from the authenticated user's saved locations"
                parameters:
                    - name: locationId
                      in: path
                      required: true
                      schema:
                        type: integer
                      description: The ID of the location to remove

        # Admin specific endpoints
        admin_get_users:
            class: ApiPlatform\Metadata\GetCollection
            uriTemplate: '/admin/users'
            security: 'is_granted("ROLE_ADMIN")'
            provider: App\State\Admin\UserProvider
            normalizationContext:
                groups: ['id:read', 'user:read', 'image:read', 'media_object:read']
            openapi:
                summary: 'List all users (Admin)'
                description: 'Get list of users with optional type filter (all, delivers, stores, customers) or role filter'
                parameters:
                    - name: type
                      in: query
                      schema:
                          type: string
                          enum: [all, delivers, stores, customers]
                          default: all
                      description: 'Filter users by type'
                    - name: role
                      in: query
                      schema:
                          type: string
                      description: 'Filter users by specific role (e.g., ROLE_ADMIN, ROLE_STORE, ROLE_DELIVER, ROLE_USER). Takes precedence over type filter if both are provided.'

        admin_get_user:
            class: ApiPlatform\Metadata\Get
            uriTemplate: '/admin/users/{id}'
            security: 'is_granted("ROLE_ADMIN")'
            normalizationContext:
                groups: ['id:read', 'user:read', 'image:read', 'media_object:read']
            openapi:
                summary: 'Get user by ID (Admin)'
                description: 'Get detailed information about a specific user'

        admin_create_user:
            class: ApiPlatform\Metadata\Post
            uriTemplate: '/admin/users'
            security: 'is_granted("ROLE_ADMIN")'
            denormalizationContext:
                groups: ['user:create']
            validationContext:
                groups: ['create']
            normalizationContext:
                groups: ['id:read', 'user:read', 'image:read', 'media_object:read']
            openapi:
                summary: 'Create new user (Admin)'
                description: 'Create a new user account with specified roles and permissions. Upload avatar first using POST /api/media_objects, then reference it using IRI (e.g., "/api/media_objects/123"). Use Content-Type: application/ld+json when sending IRIs. If no password is provided, a default password will be generated.'

        admin_update_user:
            class: ApiPlatform\Metadata\Put
            uriTemplate: '/admin/users/{id}'
            security: 'is_granted("ROLE_ADMIN")'
            inputFormats:
                json: ['application/json']
                jsonld: ['application/ld+json']
            denormalizationContext:
                groups: ['user:update']
            normalizationContext:
                groups: ['id:read', 'user:read', 'image:read', 'media_object:read']
            openapi:
                summary: 'Update user (Admin) - Full update'
                description: 'Update user information including roles and active status. Upload avatar first using POST /api/media_objects, then reference it using IRI. Use Content-Type: application/ld+json when sending IRIs. For partial updates, use PATCH instead.'

        admin_patch_user:
            class: ApiPlatform\Metadata\Patch
            uriTemplate: '/admin/users/{id}'
            security: 'is_granted("ROLE_ADMIN")'
            inputFormats:
                json: ['application/json']
                jsonld: ['application/ld+json']
            denormalizationContext:
                groups: ['user:update']
            normalizationContext:
                groups: ['id:read', 'user:read', 'image:read', 'media_object:read']
            openapi:
                summary: 'Update user (Admin) - Partial update'
                description: 'Partially update user information. Only provide the fields you want to update. Use Content-Type: application/ld+json when sending IRIs.'

        admin_delete_user:
            class: ApiPlatform\Metadata\Delete
            uriTemplate: '/admin/users/{id}'
            security: 'is_granted("ROLE_ADMIN")'
            openapi:
                summary: 'Delete user (Admin)'
                description: 'Permanently delete a user account'

        admin_toggle_user_active:
            class: ApiPlatform\Metadata\Post
            uriTemplate: '/admin/users/{id}/toggle-active'
            security: 'is_granted("ROLE_ADMIN")'
            processor: App\State\Admin\ToggleUserActiveProcessor
            normalizationContext:
                groups: ['id:read', 'user:read']
            openapi:
                summary: 'Toggle user active status (Admin)'
                description: 'Activate or deactivate a user account'


    normalizationContext:
        groups: ['id:read','user:read','image:read','media_object:read','location:read']
        


