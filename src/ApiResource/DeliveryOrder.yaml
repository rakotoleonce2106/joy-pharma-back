# Delivery Order Operations (separate from main Order resource)
App\Entity\Order:
    operations:
        # Get available orders for delivery
        get_available_orders:
            class: ApiPlatform\Metadata\GetCollection
            uriTemplate: '/orders/available'
            security: 'is_granted("ROLE_USER")'
            provider: App\State\Order\AvailableOrdersProvider
            normalizationContext:
                groups: ['order:read', 'location:read', 'user:read']
            openapi:
                summary: 'Get available orders for delivery'
                description: 'Get list of orders available for delivery persons to accept'
                parameters:
                    - name: page
                      in: query
                      schema:
                          type: integer
                          default: 1
                    - name: limit
                      in: query
                      schema:
                          type: integer
                          default: 10

        # Get current active order
        get_current_order:
            class: ApiPlatform\Metadata\Get
            uriTemplate: '/orders/current'
            security: 'is_granted("ROLE_USER")'
            provider: App\State\Order\CurrentOrderProvider
            read: false
            normalizationContext:
                groups: ['order:read', 'location:read', 'user:read']
            openapi:
                summary: 'Get current active order'
                description: 'Get the current order being delivered by the user'

        # Get order history
        get_order_history:
            class: ApiPlatform\Metadata\GetCollection
            uriTemplate: '/orders/history'
            security: 'is_granted("ROLE_USER")'
            provider: App\State\Order\OrderHistoryProvider
            normalizationContext:
                groups: ['order:read', 'location:read', 'user:read']
            openapi:
                summary: 'Get order history'
                description: 'Get delivery history for current user'
                parameters:
                    - name: page
                      in: query
                      schema:
                          type: integer
                          default: 1
                    - name: limit
                      in: query
                      schema:
                          type: integer
                          default: 20
                    - name: status
                      in: query
                      schema:
                          type: string

        # Accept order
        accept_order:
            class: ApiPlatform\Metadata\Post
            uriTemplate: '/orders/{id}/accept'
            security: 'is_granted("ROLE_USER")'
            processor: App\State\Order\AcceptOrderProcessor
            input: false
            normalizationContext:
                groups: ['order:read', 'location:read', 'user:read']
            openapi:
                summary: 'Accept order for delivery'
                description: 'Accept an available order and assign it to current delivery person'

        # Reject order
        reject_order:
            class: ApiPlatform\Metadata\Post
            uriTemplate: '/orders/{id}/reject'
            security: 'is_granted("ROLE_USER")'
            processor: App\State\Order\RejectOrderProcessor
            input: false
            openapi:
                summary: 'Reject order'
                description: 'Reject an order (removes from available list)'

        # Update order status
        update_order_status:
            class: ApiPlatform\Metadata\Put
            uriTemplate: '/orders/{id}/status'
            security: 'is_granted("ROLE_USER")'
            processor: App\State\Order\UpdateOrderStatusProcessor
            input: App\Dto\UpdateOrderStatusInput
            normalizationContext:
                groups: ['order:read', 'location:read', 'user:read']
            openapi:
                summary: 'Update order status'
                description: 'Update delivery order status (processing, shipped, delivered, etc.)'

        # Validate QR code
        validate_qr:
            class: ApiPlatform\Metadata\Post
            uriTemplate: '/orders/{id}/validate-qr'
            security: 'is_granted("ROLE_USER")'
            processor: App\State\Order\ValidateQRProcessor
            input: App\Dto\ValidateQRInput
            normalizationContext:
                groups: ['order:read', 'location:read', 'user:read']
            openapi:
                summary: 'Validate QR code'
                description: 'Validate order QR code and mark as delivered'

        # Submit rating
        submit_rating:
            class: ApiPlatform\Metadata\Post
            uriTemplate: '/orders/{id}/rating'
            security: 'is_granted("ROLE_USER")'
            processor: App\State\Order\RatingProcessor
            input: App\Dto\RatingInput
            openapi:
                summary: 'Submit order rating'
                description: 'Submit rating for delivered order'

        # Report issue
        report_issue:
            class: ApiPlatform\Metadata\Post
            uriTemplate: '/orders/{id}/report-issue'
            security: 'is_granted("ROLE_USER")'
            processor: App\State\Order\ReportIssueProcessor
            input: App\Dto\ReportIssueInput
            openapi:
                summary: 'Report order issue'
                description: 'Report an issue with an order'


